var examples={},paperjs={},plugins={},svg={},util={},verlet={},BaseScene,RAD_2_DEG,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};verlet.Stick=function(){function a(a,b){var c,d,e=this;this.pointa=a,this.pointb=b,this.torn=!1,this.tearResist=9999,c=a.x-b.x,d=a.y-b.y,this.hypotenuse=Math.sqrt(c*c+d*d),this.pointa.locked&&this.pointb.locked?this.contract(function(){return null}):this.pointa.locked?this.contract=function(){var a,b,f,g;return c=e.pointb.x-e.pointa.x,d=e.pointb.y-e.pointa.y,b=Math.sqrt(c*c+d*d),b>e.tearResist&&(e.torn=!0),a=e.hypotenuse-b,f=a*c/b,g=a*d/b,e.pointb.x+=f,e.pointb.y+=g,null}:this.pointb.locked?this.contract=function(){var a,b,f,g;return c=e.pointb.x-e.pointa.x,d=e.pointb.y-e.pointa.y,b=Math.sqrt(c*c+d*d),b>e.tearResist&&(e.torn=!0),a=e.hypotenuse-b,f=a*c/b,g=a*d/b,e.pointa.x-=f,e.pointa.y-=g,null}:this.contract=function(){var a,b,f,g;return c=e.pointb.x-e.pointa.x,d=e.pointb.y-e.pointa.y,b=Math.sqrt(c*c+d*d),b>e.tearResist&&(e.torn=!0),a=e.hypotenuse-b,f=a*c/b*.5,g=a*d/b*.5,e.pointa.x-=f,e.pointa.y-=g,e.pointb.x+=f,e.pointb.y+=g,null}}return a}(),BaseScene=function(){function a(a){this.addStatic=__bind(this.addStatic,this),this.addElementPoint=__bind(this.addElementPoint,this),this.addLock=__bind(this.addLock,this),this.update=__bind(this.update,this),this.points=[],this.sticks=[],this.stickLinks=[],this.elementPoints=[],this.statics=[],this.updates=[],this.plugins=[],this.quadTree=new util.QuadTree,this.lastFrameTime=(new Date).getTime(),this.isPlaying=!0}return a.prototype.isLoaded=!1,a.prototype.isPlaying=!1,a.prototype.dom=null,a.prototype.snapDist=1,a.prototype.lastFrameTime=0,a.currentTimeStep=0,a.prototype.pause=function(){return this.isPlaying=!1},a.prototype.play=function(){this.isPlaying=!0;if(this.isLoaded)return this.update()},a.prototype.onLoaded=function(){return this.isLoaded=!0},a.prototype.onInit=function(){var a,b,c,d;d=this.plugins;for(b=0,c=d.length;b<c;b++)a=d[b],a.init(this);return this.quadTree.clear(),this.update()},a.prototype.update=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;b=(new Date).getTime(),a.currentTimeStep=Math.min(b-this.lastFrameTime,20),this.lastFrameTime=b,p=this.plugins;for(f=0,j=p.length;f<j;f++)c=p[f],c.update();q=this.points;for(g=0,k=q.length;g<k;g++)d=q[g],d.update();r=this.sticks;for(h=0,l=r.length;h<l;h++)e=r[h],e.contract();s=this.elementPoints;for(i=0,m=s.length;i<m;i++)d=s[i],d.update();t=this.stickLinks;for(o=0,n=t.length;o<n;o++)e=t[o],e.update();if(this.isPlaying)return window.requestAnimFrame(this.update,null)},a.prototype.tick=0,a.prototype.addPoint=function(a,b,c){var d,e,f;return c==null&&(c=null),a=parseFloat(a),b=parseFloat(b),f={x:a-this.snapDist/2,y:b-this.snapDist/2,width:this.snapDist,height:this.snapDist},d=this.quadTree.find(f),d.length>0?e=d[0].point:(e=this.createPoint(a,b,c),this.quadTree.insert({x:a,y:b,point:e}),this.points.push(e)),e},a.prototype.createPoint=function(a,b,c){var d;switch(c){case"rubber":d=new verlet.RubberPoint(a,b);break;default:d=new verlet.Point(a,b)}return d},a.prototype.addLock=function(a,b,c){var d;return d=this.addPoint(b,c),d.locked=!0},a.prototype.addElementPoint=function(a,b,c,d){},a.prototype.addStatic=function(a){return this.statics.push(a)},a.prototype.addPlugin=function(a){return this.plugins.push(a)},a.prototype.isMobile=function(){return navigator.userAgent.match(/Android/)||navigator.userAgent.match(/iPhone/)||navigator.userAgent.match(/iPod/)||navigator.userAgent.match(/iPad/)},a}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),svg.Scene=function(a){function b(a){this.addSvgStick=__bind(this.addSvgStick,this),this.addPolyStick=__bind(this.addPolyStick,this),this.addPathStick=__bind(this.addPathStick,this),this.addHiddenStick=__bind(this.addHiddenStick,this),this.addElementPoint=__bind(this.addElementPoint,this),this.addLink=__bind(this.addLink,this),this.parseGroup=__bind(this.parseGroup,this),this.parseByColors=__bind(this.parseByColors,this),this.parseByGroups=__bind(this.parseByGroups,this),this.onLoaded=__bind(this.onLoaded,this),this.onEmbedLoad=__bind(this.onEmbedLoad,this),b.__super__.constructor.call(this,a),util.General.copyObject(a,this.options),this.options.callback!=null&&(this.onLoadCallback=a.callback),this.container=$(this.options.container),this.options.file?this.container.load(this.options.file,this.onLoaded):setTimeout(this.onLoaded,1),setTimeout(function(){return window.scrollTo(0,1)},0)}return __extends(b,a),b.prototype.isLoaded=!1,b.prototype.offsetX=0,b.prototype.offsetY=0,b.prototype.options={container:"#container",verticalAlign:"center",horizontalAlign:"center",callback:null,file:null,parseColors:{lock:"#FF0000",link:"#FF0000"}},b.prototype.onLoadCallback=null,b.prototype.onEmbedLoad=function(a){return console.log("embed",a),this.dom=this.svg=$("embed").find("svg")[0]},b.prototype.onLoaded=function(){var a;return b.__super__.onLoaded.call(this),this.dom=this.svg=this.container.find("svg")[0],a=this,console.log("loaded",this.svg,this.dom),this.parseByGroups(),this.verticalAlign(this.options.verticalAlign),this.horizontalAlign(this.options.horizontalAlign),this.dom.dispatchEvent(new Event("onSceneLoaded",{bubbles:!0,cancelable:!0})),typeof this.onLoadCallback=="function"&&this.onLoadCallback(),this.onInit()},b.prototype.verticalAlign=function(a){switch(a){case"center":this.offsetY+=$(this.svg).height()*-0.5;break;case"top":this.offsetY=0}return this.updateFrameOffset()},b.prototype.horizontalAlign=function(a){switch(a){case"center":this.offsetX+=$(this.svg).width()*-0.5;break;case"left":this.offsetX=0}return this.updateFrameOffset()},b.prototype.updateFrameOffset=function(){return $(this.svg).css("marginLeft",this.offsetX),$(this.svg).css("marginTop",this.offsetY)},b.prototype.offsetFrame=function(a,b){return this.offsetX+=a,this.offsetY+=b,this.updateFrameOffset()},b.prototype.setSize=function(a,b){return this.svg.setAttribute("width",a),this.svg.setAttribute("height",b),this.svg.setAttribute("viewBox","0 0 "+a+" "+b)},b.prototype.parseByGroups=function(){var a,b;return a=$(this.svg),b=this,a.find('[id^="Statics"]').find("g").each(function(){return b.addStatic(this)}),a.find('[id^="Locks"]').find("circle,ellipse").each(function(){return b.addLock(this,this.getAttribute("cx"),this.getAttribute("cy")),$(this).remove()}),a.find('[id^="Hit"]').each(function(){return b.makeInvisible(this)}),a.find('[id^="HiddenVerlets"]').find("line").each(function(){return b.addHiddenStick(this)}),a.find('[id^="Verlets"]').find("polyline").each(function(){return b.addPolyStick(this)}),a.find('[id^="Verlets"]').find("line").each(function(){return b.addSvgStick(this)}),a.find('[id^="Points"]').find("polyline").each(function(){return b.addPolyStick(this,!0)}),a.find('[id^="Points"]').find("line").each(function(){return b.addSvgStick(this,!1,!0)}),a.find('[id^="Points"]').find("path").each(function(){return b.addPathStick(this,!0)}),a.find('[id^="RubberPoints"]').find("polyline, polygon").each(function(){return b.addPolyStick(this,!0,"rubber")}),a.find('[id^="RubberPoints"]').find("line").each(function(){return b.addSvgStick(this,!1,!0,"rubber")}),a.find('[id^="RubberPoints"]').find("path").each(function(){return b.addPathStick(this,!0,"rubber")}),a.find("#Links").find("line").each(function(){return b.addLink(this)})},b.prototype.makeInvisible=function(a){return a.setAttribute("fill","rgba(0,0,0,0)")},b.prototype.parseByColors=function(){return $(this.svg).children().each(this.parseGroup)},b.prototype.parseGroup=function(a){var b;return b=this,$(a).children().each(function(){switch(this.nodeName){case"g":return this.id.length>0&&b.addStatic(this),b.parseGroup(this);case"circle":switch(this.getAttribute("fill")){case b.options.parseColors.lock:return b.addLock(this,this.attr("cx"),this.attr("cy"))}break;case"line":switch(this.getAttribute("stroke")){case b.options.parseColors.link:return b.addLink(this);default:return b.addSvgStick(this)}}})},b.prototype.addLink=function(a){var b,c,d,e,f,g,h,i,j,k,l;c=$(a),f=this.addPoint(c.attr("x1"),c.attr("y1")),g=this.addPoint(c.attr("x2"),c.attr("y2")),g.x<f.x?(d=g,e=f):(d=f,e=g),this.sticks.push(i=new svg.StickLink(d,e)),this.stickLinks.push(i),b=c[0].id.split("Link")[1],l=this.statics;for(j=0,k=l.length;j<k;j++){h=l[j];if(h.id===b){i.setLink(h);break}}return c.remove()},b.prototype.addElementPoint=function(a,b,c,d){var e,f;return e=this.addPoint(c,d),f=new svg.Point(a,b,e),this.elementPoints.push(f),e},b.prototype.addHiddenStick=function(a){return this.addSvgStick(a,!0)},b.prototype.addPathStick=function(a,b,c){var d,e,f,g,h,i,j;b==null&&(b=!1),c==null&&(c=null),j=a.pathSegList,d=0,e=j.numberOfItems,h=[];while(d<e){i=j.getItem(d);switch(i.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:g=this.addPoint(parseFloat(i.x),parseFloat(i.y),c),h.length===0&&h.push(g);break;case SVGPathSeg.PATHSEG_LINETO_REL:f=this.addPoint(parseFloat(i.x),parseFloat(i.y),c),b||this.addUniqueStick(lastPoint,f),h.push(f);break;case SVGPathSeg.PATHSEG_CLOSEPATH:console.log("close")}++d}if(h.length>1)return this.elementPoints.push(new svg.Path(a,h))},b.prototype.addPolyStick=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;b==null&&(b=!1),c==null&&(c=null),g=a.getAttribute("points"),h=g.split(" "),f=[],d=1;for(l=0,m=h.length;l<m;l++)e=h[l],j=e.split(","),!isNaN(j[0])&&!isNaN(j[1])&&(k=this.addPoint(j[0],j[1],c),f.push(k),d%2===0&&!b&&this.addUniqueStick(i,k),i=k),d++;return this.elementPoints.push(new svg.PolyLine(a,f))},b.prototype.addUniqueStick=function(a,b){var c,d,e,f,g;c=!1,g=this.sticks;for(e=0,f=g.length;e<f;e++){d=g[e];if(d.pointa===a&&d.pointb===b||d.pointa===b&&d.pointb===a||a===b){c=!0;break}}return c||this.sticks.push(new verlet.Stick(a,b)),!c},b.prototype.addSvgStick=function(a,b,c,d){var e,f;b==null&&(b=!1),c==null&&(c=!1),d==null&&(d=null),e=this.addPoint(a.getAttribute("x1"),a.getAttribute("y1"),d),f=this.addPoint(a.getAttribute("x2"),a.getAttribute("y2"),d),c?(this.elementPoints.push(new svg.Point(a,1,e)),this.elementPoints.push(new svg.Point(a,2,f))):this.addUniqueStick(e,f)&&(this.elementPoints.push(new svg.Point(a,1,e)),this.elementPoints.push(new svg.Point(a,2,f)));if(b)return a.remove()},b}(BaseScene),paperjs.Scene=function(a){function b(a,c){var d;c==null&&(c={}),this.onResize=__bind(this.onResize,this),this.update=__bind(this.update,this),this.addElementPoint=__bind(this.addElementPoint,this),this.onLoadedSVG=__bind(this.onLoadedSVG,this),b.__super__.constructor.call(this),c.width!=null&&(this.settings.width=c.width),c.height!=null&&(this.settings.height=c.height),console.log(this.settings.width,this.settings.height),this.settings.width==null&&(this.settings.width=$(window).width(),this.settings.fullscreen=!0),this.settings.height==null&&(this.settings.height=$(window).height()),d=$("<canvas width='"+this.settings.width+"' height ='"+this.settings.height+"'/>"),$(this.settings.container).append(d),this.dom=this.canvas=d[0],console.log(paper),paper.setup(this.canvas),this.project=paper.project,this.view=paper.view,this.width=this.settings.width,this.height=this.settings.height,$.get(a,this.onLoadedSVG),this.settings.fullscreen&&$(window).resize(this.onResize)}return __extends(b,a),b.prototype.settings={width:null,height:null,container:"#container",fullscreen:!1},b.prototype.elements={verlets:null,locks:null,winds:null,statics:null},b.prototype.quadTest=function(){var a,b,c,d,e,f,g,h,i,j,k;b=0;while(b<500)d={x:Math.random()*1e3,y:Math.random()*1e3,width:1,height:1},a=new paper.Path.Circle(new paper.Point(d.x,d.y),2),a.fillColor="red",d.obj=a,this.quadTree.insert(d),b++;g=Math.random()*500,h=Math.random()*500,i={x:g,y:g,width:10,height:10},f=this.quadTree.retrieve(i),e=new paper.Path.Rectangle(new paper.Point(i.x,i.y),new paper.Size(i.width,i.height)),e.strokeColor="red",console.log(f);for(j=0,k=f.length;j<k;j++)c=f[j],console.log(c),c.x>=i.x&&c.y>=i.y&&c.x<i.width+i.x&&c.y<i.height+i.y?(c.obj.fillColor="green",console.log("found ",c)):c.obj.fillColor="blue";return this.view.draw()},b.prototype.onLoadedSVG=function(a){var b;return this.onLoaded(),b=this.project.importSVG($(a).find("svg")[0]),console.log("boo",b),b.children.Statics!=null&&(this.elements.statics=b.children.Statics),b.children.Links!=null&&(this.elements.links=b.children.Links),b.children.Locks!=null&&(this.elements.locks=b.children.Locks),b.children.Wind!=null&&(this.elements.winds=b.children.Wind),b.children.Verlets!=null&&(this.elements.verlets=b.children.Verlets),b.children.HiddenVerlets!=null&&(this.elements.hiddenVerlets=b.children.HiddenVerlets),this.view.draw(),this.initElements(),this.onInit()},b.prototype.initElements=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;b=[],o=this.elements.locks.children;for(c=0,g=o.length;c<g;c++)a=o[c],this.addLock(a,a.position.x,a.position.y),b.push(a);p=this.elements.statics.children;for(d=0,h=p.length;d<h;d++)a=p[d],this.addStatic(a);q=this.elements.verlets.children;for(e=0,i=q.length;e<i;e++)a=q[e],this.addStick(a);if(this.elements.hiddenVerlets!=null){r=this.elements.hiddenVerlets.children;for(f=0,j=r.length;f<j;f++)a=r[f],this.addStick(a,!0),b.push(a)}if(this.elements.links!=null){s=this.elements.links.children;for(m=0,k=s.length;m<k;m++)a=s[m],this.addLink(a),b.push(a)}t=[];for(n=0,l=b.length;n<l;n++)a=b[n],t.push(a.remove());return t},b.prototype.addElementPoint=function(a){var b,c;return b=this.addPoint(a.point.x,a.point.y),c=new paperjs.Point(b,a.point),this.elementPoints.push(c),b},b.prototype.addStick=function(a,b){var c,d;switch(a.type){case"path":if(a.segments.length>1)return b?(c=this.addPoint(a.segments[0].point.x,a.segments[0].point.y),d=this.addPoint(a.segments[1].point.x,a.segments[1].point.y)):(c=this.addElementPoint(a.segments[0]),d=this.addElementPoint(a.segments[1])),this.sticks.push(new verlet.Stick(c,d))}},b.prototype.addLink=function(a){var b,c,d,e,f,g,h,i,j,k;switch(a.type){case"path":if(a.segments.length>1){e=this.addPoint(a.segments[0].point.x,a.segments[0].point.y),f=this.addPoint(a.segments[1].point.x,a.segments[1].point.y),f.x<e.x?(c=f,d=e):(c=e,d=f),this.sticks.push(h=new paperjs.StickLink(c,d)),this.stickLinks.push(h),b=a.name.split("Link")[1],k=this.statics;for(i=0,j=k.length;i<j;i++){g=k[i];if(g.name===b){h.setLink(g);return}}}}},b.prototype.update=function(){return b.__super__.update.call(this),this.view.draw()},b.prototype.onResize=function(){return this.canvas.setAttribute("width",window.innerWidth),this.canvas.setAttribute("height",window.innerHeight)},b}(BaseScene),examples.ColorPaperScene=function(a){function b(){return this.assignPalette=__bind(this.assignPalette,this),this.onLoadedSVG=__bind(this.onLoadedSVG,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.settings={defaultBg:"#FFFFFF",defaultFg:"#CCCCCC"},b.prototype.onLoadedSVG=function(a){return this.assignPalette($(a).find("svg")[0]),console.log("loaded palette!",a),b.__super__.onLoadedSVG.call(this,a)},b.prototype.assignPalette=function(a){var b,c,d,e,f,g=this;return f=Math.random()>.5,f?(util.General.randomSeed=(new Date).getTime()*.5,console.log("rnd",util.General.randomFromSeed(),util.General.randomSeed),c=Math.random(),b=c+(Math.random()*.5+.25),b>=1&&(b-=1),this.bgColor=util.Color.hsvToHex(b,.15,.75),d=Math.random()*.5+.5,e=.4+Math.random()*.2,this.fgColor=util.Color.hsvToHex(c,d,e),this.highlightColor=util.Color.hsvToHex(c,d,Math.min(e+.5,1))):(c=Math.random(),b=c+(Math.random()*.5+.25),b>=1&&(b-=1),this.bgColor=util.Color.hsvToHex(b,.15+Math.random()*.4,.1+Math.random()*.1),d=Math.random()*.1+.3,e=.2+Math.random()*.2,this.highlightColor=util.Color.hsvToHex(c,d,e),this.fgColor=util.Color.hsvToHex(c,d+.5,Math.min(e+.8,1))),$("html, body").css("background-color",this.bgColor),$(a).find("line, rect, circle, polygon, polyline, path").each(function(a,b){var c;$(b).attr("stroke")!=null&&$(b).attr("stroke",g.fgColor),c=$(b).attr("fill");if(c===g.settings.defaultBg)return $(b).attr("fill",g.settings.bgColor);if(c===g.settings.defaultFg)return $(b).attr("fill",g.highlightColor)})},b}(paperjs.Scene),examples.ColorSvgScene=function(a){function b(a){this.onLoaded=__bind(this.onLoaded,this),b.__super__.constructor.call(this,a),this.generatePalette()}return __extends(b,a),b.prototype.settings={defaultBgColor:"#FFFFFF",defaultFgColor:"#666666",defaultHighlightColor:"#CCCCCC",defaultSecondaryColor:"#999999"},b.prototype.onLoaded=function(){return b.__super__.onLoaded.call(this),this.assignPalette()},b.prototype.generatePalette=function(){var a,b,c,d,e,f;return this.isLight=Math.random()>.5,this.isLight?(util.General.randomSeed=(new Date).getTime()*.001,b=util.General.randomFromSeed(),a=b+(Math.random()*.5+.25),a>=1&&(a-=1),c=Math.random()*.5+.5,d=.5+Math.random()*.2,this.bgColor=util.Color.hsvToHex(a,Math.random()*.1,.8),e=b+.1,e>1&&(e-=1),f=Math.min(d+Math.random()*.4,1),this.secondaryColor=util.Color.hsvToHex(e,c,f),this.fgColor=util.Color.hsvToHex(b,c,d),this.highlightColor=util.Color.hsvToHex(b,c,Math.min(d+.5,1))):(util.General.randomSeed=(new Date).getTime()*.5,b=util.General.randomFromSeed(),a=b+(Math.random()*.5+.25),a>=1&&(a-=1),this.bgColor=util.Color.hsvToHex(a,.15+Math.random()*.2,Math.random()*.1),c=Math.random()*.1+.3,d=.2+Math.random()*.2,this.highlightColor=util.Color.hsvToHex(b,c,d),e=b+.1,e>1&&(e-=1),f=Math.min(d+Math.random()*.4,1),this.secondaryColor=util.Color.hsvToHex(e,c,f),this.fgColor=util.Color.hsvToHex(b,c+.5,Math.min(d+.8,1))),$("html, body").css("background-color",this.bgColor)},b.prototype.assignPalette=function(){var a=this;return $(this.svg).find("line, rect, circle, polygon, polyline, path").each(function(b,c){var d,e;e=$(c).attr("stroke"),d=$(c).attr("fill");switch(e){case a.settings.defaultFgColor:$(c).attr("stroke",a.fgColor);break;case a.settings.defaultBgColor:$(c).attr("stroke",a.bgColor);break;case a.settings.defaultHighlightColor:$(c).attr("stroke",a.highlightColor);break;case a.settings.defaultSecondaryColor:$(c).attr("stroke",a.secondaryColor)}switch(d){case a.settings.defaultFgColor:return $(c).attr("fill",a.fgColor);case a.settings.defaultBgColor:return $(c).attr("fill",a.bgColor);case a.settings.defaultHighlightColor:return $(c).attr("fill",a.highlightColor);case a.settings.defaultSecondaryColor:return $(c).attr("fill",a.secondaryColor)}})},b}(svg.Scene),examples.GenerativeSvgScene=function(a){function b(){return this.addNewElements=__bind(this.addNewElements,this),this.onLoaded=__bind(this.onLoaded,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.onLoaded=function(){return this.svg=this.container.find("svg")[0],this.addNewElements(),b.__super__.onLoaded.call(this)},b.prototype.addNewElements=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;g=$(this.svg).find("#Verlets"),d=$(this.svg).find("#Locks"),h=$(this.svg).find("#Wind"),a=$(this.svg).find("#Verlets line"),b=d.find("circle"),c=h.find("circle"),w=100,t=4,u=60,s=t*u+w,this.setSize(s*2,s*2),x=s,y=s,console.log("sx,sy",x,y),z=parseFloat(c.attr("cx"))-parseFloat(b.attr("cx")),A=parseFloat(c.attr("cy"))-parseFloat(b.attr("cy"));for(l=B=0;0<=t?B<=t:B>=t;l=0<=t?++B:--B){v=l*4+1,m=0,k=l*u;while(m<v){r=Math.PI*2*m/v,p=x+Math.cos(r)*k,q=y+Math.sin(r)*k,e=b.clone(),d.append(e),this.assignCirclePosition(e,p,q),f=c.clone(),h.append(f),this.assignCirclePosition(f,p+z,q+A),i=parseFloat($(a[0]).attr("x1")),j=parseFloat($(a[0]).attr("y1"));for(C=0,D=a.length;C<D;C++)n=a[C],o=$(n).clone(),g.append(o),this.offsetLinePosition(o,-i+p,-j+q);m++}}return a.remove(),c.remove(),b.remove()},b.prototype.assignCirclePosition=function(a,b,c){return a.attr("cx",b),a.attr("cy",c)},b.prototype.offsetLinePosition=function(a,b,c){return a.attr("x1",parseFloat(a.attr("x1"))+b),a.attr("y1",parseFloat(a.attr("y1"))+c),a.attr("x2",parseFloat(a.attr("x2"))+b),a.attr("y2",parseFloat(a.attr("y2"))+c)},b}(examples.ColorSvgScene),paperjs.Point=function(){function a(a,b){this.verletPoint=a,this.paperPoint=b}return a.prototype.update=function(){return this.paperPoint.x=this.verletPoint.x,this.paperPoint.y=this.verletPoint.y},a}(),paperjs.StickLink=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.rotation=0,b.prototype.link=null,b.prototype.offset=null,b.prototype.update=function(){var a,b;return b=Math.atan2(this.pointb.y-this.pointa.y,this.pointb.x-this.pointa.x)*RAD_2_DEG,a=b-this.rotation,this.rotation=b,this.group.position=this.pointa,this.group.position.x-=this.c.position.x-this.pointa.x,this.group.position.y-=this.c.position.y-this.pointa.y,this.group.rotate(a,this.pointa)},b.prototype.setLink=function(a){return this.group=new paper.Group,this.c=new paper.Group,this.c.position=this.pointa,this.link=a,this.group.addChild(a),this.group.addChild(this.c),this.link.position.x+=1,this.link.position.y+=1},b}(verlet.Stick),plugins.Gravity=function(){function a(a,b,c){this.useMobileTilt=c!=null?c:!0,this.update=__bind(this.update,this),this.init=__bind(this.init,this),a!=null&&(this.y=a),b!=null&&(this.x=b),console.log(this.x,this.y)}return a.prototype.x=0,a.prototype.y=.02,a.prototype.points=null,a.prototype.useMobileTilt=!0,a.prototype.init=function(a){var b,c,d,e,f=this;this.scene=a,this.points=[],e=this.scene.points;for(c=0,d=e.length;c<d;c++)b=e[c],b.locked||this.points.push(b);if(this.useMobileTilt&&this.scene.isMobile())return window.ondevicemotion=function(a){return f.x=parseFloat(a.accelerationIncludingGravity.x)*.03,f.y=parseFloat(a.accelerationIncludingGravity.y)*-0.03}},a.prototype.update=function(){var a,b,c,d,e,f,g,h;b=BaseScene.currentTimeStep,c=this.x*b,d=this.y*b,g=this.points,h=[];for(e=0,f=g.length;e<f;e++)a=g[e],h.push(a.force(c,d));return h},a}(),plugins.MousePull=function(){function a(a,b){this.update=__bind(this.update,this),this.onTouchMove=__bind(this.onTouchMove,this),this.onMouseMove=__bind(this.onMouseMove,this),this.initMobile=__bind(this.initMobile,this),this.onResize=__bind(this.onResize,this),this.init=__bind(this.init,this),a!=null&&(this.strength=a),b!=null&&(this.downStrength=b)}return a.prototype.mouse={x:-9999,y:-9999,down:0},a.prototype.strength=.001,a.prototype.downStrength=.01,a.prototype.svg=null,a.prototype.scene=null,a.prototype.points=null,a.offsetX=0,a.offsetY=0,a.prototype.init=function(a){var b,c,d,e;this.scene=a,this.dom=this.scene.dom,this.points=[],e=this.scene.points;for(c=0,d=e.length;c<d;c++)b=e[c],b.locked||this.points.push(b);return this.scene.isMobile()?this.initMobile():this.initDesktop(),$(window).resize(this.onResize),this.scene.dom.addEventListener("onSceneLoaded",this.onResize,!1),this.onResize()},a.prototype.onResize=function(){var a,b;return b=$(window).width(),a=$(window).height(),this.offsetX=$(this.dom).offset().left,this.offsetY=$(this.dom).offset().top},a.prototype.initMobile=function(){var a=this;return this.strength=.1,this.downStrength=1,document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("touchend",function(b){return a.mouse.down=0,a.mouse.x=-9999,a.mouse.y=-9999}),document.addEventListener("touchstart",function(b){return a.mouse.down=1})},a.prototype.initDesktop=function(){var a=this;return this.mouse.down=1,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mousedown",function(){return a.mouse.down=2}),document.addEventListener("mouseup",function(){return a.mouse.down=1})},a.prototype.onMouseMove=function(a){return this.mouse.x=a.pageX-this.offsetX,this.mouse.y=a.pageY-this.offsetY},a.prototype.onTouchMove=function(a){return this.mouse.x=a.touches[0].pageX-this.offsetX,this.mouse.y=a.touches[0].pageY-this.offsetY,a.preventDefault(),null},a.prototype.update=function(){var a,b,c,d,e,f,g,h,i,j;if(this.mouse.down<1)return;a=this.mouse.down>1?this.downStrength:this.strength,a*=BaseScene.currentTimeStep*.1,d=this.mouse.x,e=this.mouse.y,i=this.points,j=[];for(g=0,h=i.length;g<h;g++)f=i[g],b=f.x-d,c=f.y-e,b*b+c*c<1e4?j.push(f.force((d-f.x)*a,(e-f.y)*a)):j.push(void 0);return j},a}(),plugins.NoiseWarp=function(){function a(){this.noise=new util.ImprovedNoise}return a.prototype.noise=null,a.prototype.speed=.01,a.prototype.zoom=.002,a.prototype.strength=.1,a.prototype.offsetX=1,a.prototype.offsetY=1,a.prototype.offsetZ=2,a.prototype.skip=0,a.prototype.init=function(a){var b,c,d,e,f;this.scene=a,c=this,f=this.scene.points;for(d=0,e=f.length;d<e;d++)b=f[d],b.warpDampen=Math.max(this.noise.noise(b.x*.1,b.y*.1,1)*.2+.1,.01);return this.update=function(){var a,c,d,e,f,g,h,i;a=BaseScene.currentTimeStep*this.strength,g=this.scene.points;for(c=0,e=g.length;c<e;c++)b=g[c],b.x+=(b.originalX+this.noise.noise(b.x*this.zoom+this.offsetX,b.y*this.zoom+this.offsetY,this.offsetZ)*a-b.x)*b.warpDampen,b.y+=(b.originalY+this.noise.noise(b.x*this.zoom+1+this.offsetX,b.y*this.zoom+this.offsetY,this.offsetZ)*a-b.y)*b.warpDampen;this.offsetZ+=this.speed,h=this.scene.elementPoints,i=[];for(d=0,f=h.length;d<f;d++)b=h[d],i.push(b.update());return i}},a.prototype.update=function(){},a}(),plugins.StatWrapper=function(){function a(){this.update=__bind(this.update,this)}return a.prototype.init=function(a){return this.scene=a,this.stats=new Stats,this.stats.domElement.setAttribute("style","position:fixed; top: 0; left: 0;"),document.body.appendChild(this.stats.domElement)},a.prototype.update=function(){return this.stats.begin(),this.stats.end()},a}(),plugins.Wind=function(){function a(a){this.useSvgPoints=a!=null?a:!1,this.noise=new util.ImprovedNoise}return a.prototype.noise=null,a.prototype.speed=.01,a.prototype.zoom=.002,a.prototype.strength=.1,a.prototype.windPoints=null,a.prototype.offsetX=1,a.prototype.offsetY=1,a.prototype.offsetZ=2,a.prototype.skip=0,a.prototype.init=function(a){var b,c,d,e,f;this.scene=a,c=this,this.windPoints=[];if(this.useSvgPoints)$(this.scene.dom).find('[id^="Wind"]').find("circle,ellipse").each(function(){var a,b,d,e;return a=$(this),d=a.attr("cx"),e=a.attr("cy"),a.remove(),b=c.scene.addPoint(d,e),c.windPoints.push(b)});else{f=this.scene.points;for(d=0,e=f.length;d<e;d++)b=f[d],b.locked||this.windPoints.push(b)}return this.update=function(){var a,c,d,e;a=BaseScene.currentTimeStep*this.strength,e=this.windPoints;for(c=0,d=e.length;c<d;c++)b=e[c],b.force(this.noise.noise(b.x*this.zoom+this.offsetX,b.y*this.zoom+this.offsetY,this.offsetZ)*a,this.noise.noise(b.x*this.zoom+1+this.offsetX,b.y*this.zoom+this.offsetY,this.offsetZ)*a);return this.offsetZ+=this.speed}},a}(),svg.Path=function(){function a(a,b){this.svg=a,this.points=b}return a.prototype.svg=null,a.prototype.ab=0,a.prototype.points=null,a.prototype.update=function(){var a,b,c,d,e;b=[],e=this.points;for(c=0,d=e.length;c<d;c++)a=e[c],b.push(a.x+","+a.y+"");return this.svg.setAttribute("d","M"+b.join("l"))},a}(),svg.Point=function(){function a(a,b,c){this.svg=a,this.ab=b,this.point=c,this.ab===1?this.update=function(){return this.svg.setAttribute("x1",this.point.x),this.svg.setAttribute("y1",this.point.y),this.lastValX=this.point.x,this.lastValY=this.point.y}:this.update=function(){return this.svg.setAttribute("x2",this.point.x),this.svg.setAttribute("y2",this.point.y),this.lastValX=this.point.x,this.lastValY=this.point.y}}return a.prototype.svg=null,a.prototype.ab=0,a.prototype.point=null,a.prototype.lastValX=0,a.prototype.lastValY=0,a}(),svg.PolyLine=function(){function a(a,b){this.svg=a,this.points=b}return a.prototype.svg=null,a.prototype.ab=0,a.prototype.points=null,a.prototype.update=function(){var a,b,c,d,e;b="",e=this.points;for(c=0,d=e.length;c<d;c++)a=e[c],b+=a.x+","+a.y+" ";return this.svg.setAttribute("points",b)},a}(),svg.StickLink=function(a){function b(){return this.offsetPolygon=__bind(this.offsetPolygon,this),this.offsetChildren=__bind(this.offsetChildren,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.rotation=0,b.prototype.link=null,b.prototype.update=function(){var a,b,c;return c=Math.atan2(this.pointb.y-this.pointa.y,this.pointb.x-this.pointa.x)*RAD_2_DEG,a=Math.round(this.pointa.x*10)/10,b=Math.round(this.pointa.y*10)/10,this.link.setAttribute("transform","translate("+a+","+b+") rotate("+c+")")},b.prototype.setLink=function(a){var b;return this.link=a,b=this,this.offsetChildren(a)},b.prototype.offsetChildren=function(a){var b;return b=this,$(a).children().each(function(){return this.setAttribute("transform","translate(-"+b.pointa.x+", -"+b.pointa.y+")")})},b.prototype.offsetPolygon=function(a){var b,c,d,e,f,g;d="",g=a.getAttribute("points").split(" ");for(e=0,f=g.length;e<f;e++)c=g[e],b=c.split(","),b.length>1&&(b[0]-=this.pointa.x,b[1]-=this.pointa.y,d+=b[0]+","+b[1]+" ");return a.setAttribute("points",d)},b}(verlet.Stick),util.Color=function(){function a(){}return a.hexToRgb=function(a){return typeof a=="string"&&(a=a.match(/\w\w/g)),["0x"+a[0]-0,"0x"+a[1]-0,"0x"+a[2]-0]},a.componentToHex=function(a){var b;return b=a.toString(16),b.length===1?"0"+b:b},a.rgbToHex=function(a,b,c){return"#"+this.componentToHex(a)+this.componentToHex(b)+this.componentToHex(c)},a.hsvToHex=function(a,b,c){var d,e,f,g,h,i,j,k;j=void 0,f=void 0,d=void 0,g=void 0,e=void 0,h=void 0,i=void 0,k=void 0,a&&b===undefined&&c===undefined&&(b=a.s,c=a.v,a=a.h),g=Math.floor(a*6),e=a*6-g,h=c*(1-b),i=c*(1-e*b),k=c*(1-(1-e)*b);switch(g%6){case 0:j=c,f=k,d=h;break;case 1:j=i,f=c,d=h;break;case 2:j=h,f=c,d=k;break;case 3:j=h,f=i,d=c;break;case 4:j=k,f=h,d=c;break;case 5:j=c,f=h,d=i}return this.rgbToHex(Math.floor(j*255),Math.floor(f*255),Math.floor(d*255))},a}(),util.General=function(){function a(){}return a.copyObject=function(a,b){var c,d;for(c in a)d=a[c],b[c]=d},a.propertyById=function(a,b){var c,d,e;c=0;for(d in a){e=a[d];if(c===b)return a[d];c++}return void 0},a.randomSeed=1,a.randomFromSeed=function(){var a;return a=Math.sin(this.randomSeed++)*1e4,a-Math.floor(a)},a.randomPropery=function(a){var b,c,d;b=0,d=null;for(c in a)Math.random()<1/++b&&(d=c);return a[d]},a.copyToNewObject=function(a){var b,c,d;c={};for(b in a)d=a[b],c[b]=d;return c},a.objectPropertyLength=function(a){var b,c,d;b=0;for(c in a)d=a[c],b++;return b},a.randomFromArray=function(a){return a[Math.floor(Math.random()*a.length)]},a.randomFromRange=function(a,b){return a+Math.random()*(b-a)},a}(),RAD_2_DEG=180/Math.PI,util.ImprovedNoise=function(){function f(){}var a,b,c,d,e;a=function(a){return a*a*a*(a*(a*6-15)+10)},d=function(a,b,c){return b+a*(c-b)},b=function(a,b,c,d){var e,f,g;return e=a&15,f=e<8?b:c,g=e<4?c:e===12||e===14?b:d,((e&1)===0?f:-f)+((e&2)===0?g:-g)},e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=0;while(c<256)e[256+c]=e[c],c++;return f.prototype.noise=function(c,f,g){var h,i,j,k,l,m,n,o,q,r,s,t,u,v,w,x,y,z;return r=~~c,s=~~f,t=~~g,n=r&255,o=s&255,q=t&255,c-=r,f-=s,g-=t,x=c-1,y=f-1,z=g-1,u=a(c),v=a(f),w=a(g),h=e[n]+o,i=e[h]+q,j=e[h+1]+q,k=e[n+1]+o,l=e[k]+q,m=e[k+1]+q,d(w,d(v,d(u,b(e[i],c,f,g),b(e[l],x,f,g)),d(u,b(e[j],c,y,g),b(e[m],x,y,g))),d(v,d(u,b(e[i+1],c,f,z),b(e[l+1],x,f,g-1)),d(u,b(e[j+1],c,y,z),b(e[m+1],x,y,z))))},f}(),util.QuadTree=function(){function a(a,b,c,d){this.max_objects=b!=null?b:5,this.max_levels=c!=null?c:4,this.level=d!=null?d:0,this.retrieve=__bind(this.retrieve,this),this.find=__bind(this.find,this),this.insert=__bind(this.insert,this),this.getIndex=__bind(this.getIndex,this),this.split=__bind(this.split,this),this.bounds=a||{x:-20,y:-20,width:2048,height:2048},this.objects=[],this.nodes=[]}return a.prototype.split=function(){var b,c,d,e,f;return b=this.level+1,d=Math.round(this.bounds.width/2),c=Math.round(this.bounds.height/2),e=Math.round(this.bounds.x),f=Math.round(this.bounds.y),this.nodes[0]=new a({x:e+d,y:f,width:d,height:c},this.max_objects,this.max_levels,b),this.nodes[1]=new a({x:e,y:f,width:d,height:c},this.max_objects,this.max_levels,b),this.nodes[2]=new a({x:e,y:f+c,width:d,height:c},this.max_objects,this.max_levels,b),this.nodes[3]=new a({x:e+d,y:f+c,width:d,height:c},this.max_objects,this.max_levels,b)},a.prototype.getIndex=function(a){var b,c,d,e,f;return d=-1,f=this.bounds.x+this.bounds.width/2,c=this.bounds.y+this.bounds.height/2,e=a.y<c&&a.y+a.height<c,b=a.y>c,a.x<f&&a.x+a.width<f?e?d=1:b&&(d=2):a.x>f&&(e?d=0:b&&(d=3)),d},a.prototype.insert=function(a){var b,c,d,e;d=this,b=0,c=void 0;if(typeof this.nodes[0]!="undefined"){c=this.getIndex(a);if(c!==-1){this.nodes[c].insert(a);return}}this.objects.push(a);if(this.objects.length>this.max_objects&&this.level<this.max_levels){typeof this.nodes[0]=="undefined"&&this.split(),e=[];while(b<this.objects.length)c=this.getIndex(this.objects[b]),c!==-1?e.push(this.nodes[c].insert(this.objects.splice(b,1)[0])):e.push(b+=1);return e}},a.prototype.find=function(a){var b,c,d,e,f;b=[],f=this.retrieve(a);for(d=0,e=f.length;d<e;d++)c=f[d],c.x>=a.x&&c.y>=a.y&&c.x<a.width+a.x&&c.y<a.height+a.y&&b.push(c);return b},a.prototype.retrieve=function(a){var b,c,d;c=this.getIndex(a),d=this.objects;if(typeof this.nodes[0]!="undefined")if(c!==-1)d=d.concat(this.nodes[c].retrieve(a));else{b=0;while(b<this.nodes.length)d=d.concat(this.nodes[b].retrieve(a)),b+=1}return d},a.prototype.clear=function(){var a,b;this.objects=[],a=0,b=[];while(a<this.nodes.length)typeof this.nodes[a]!="undefined"&&(this.nodes[a].clear(),delete this.nodes[a]),b.push(a+=1);return b},a}(),verlet.Point=function(){function a(a,b,c){this.x=a,this.y=b,this.locked=c!=null?c:!1,this.originalX=this.oldX=this.x,this.originalY=this.oldY=this.y}return a.prototype.down=!1,a.prototype.oldX=null,a.prototype.oldY=null,a.prototype.originalX=0,a.prototype.originalY=0,a.prototype.x=0,a.prototype.y=0,a.prototype.forceX=0,a.prototype.forceY=0,a.scene=null,a.prototype.setPos=function(a,b){return this.x=this.oldX=a,this.y=this.oldY=b},a.prototype.force=function(a,b){return this.forceX+=a,this.forceY+=b},a.prototype.update=function(){var a,b;return this.dead||this.down||this.locked?null:(a=this.x,b=this.y,this.x+=this.x-this.oldX+this.forceX,this.y+=this.y-this.oldY+this.forceY,this.oldX=a,this.oldY=b,this.forceX=0,this.forceY=0,null)},a}(),verlet.RubberPoint=function(a){function b(a,c,d){this.x=a,this.y=c,this.locked=d!=null?d:!1,b.__super__.constructor.call(this,this.x,this.y,this.locked),this.rubberAmplitude=util.General.randomFromRange(verlet.RubberPoint.minAmp,verlet.RubberPoint.maxAmp)}return __extends(b,a),b.prototype.rubberAmplitude=.1,b.prototype.rubberDamping=.1,b.prototype.rubberForceX=0,b.prototype.rubberForceY=0,b.maxAmp=.2,b.minAmp=.05,b.prototype.force=function(a,b){return this.forceX+=a,this.forceY+=b},b.prototype.update=function(){return this.dead||this.down||this.locked?null:(this.rubberForceX=(this.originalX-this.x)*this.rubberAmplitude*BaseScene.currentTimeStep*.1,this.rubberForceY=(this.originalY-this.y)*this.rubberAmplitude*BaseScene.currentTimeStep*.1,this.x+=(this.x+this.rubberForceX-this.x)*.99,this.y+=(this.y+this.rubberForceY-this.y)*.99,b.__super__.update.call(this))},b}(verlet.Point)